version: '3'
services:
  manager:
    container_name: manager
    ports:
      - 19001:9001
    image: registry.cn-hangzhou.aliyuncs.com/hdp-eco/hdp-eco-base
    hostname: manager

  hadoop:
    container_name: hadoop
    image: registry.cn-hangzhou.aliyuncs.com/hdp-eco/hadoop
    hostname: hadoop
    depends_on:
      - manager
    ports:
      - 50070:50070
  
  hive:
    container_name: hive
    links: 
      - mysql:mysql
    image: registry.cn-hangzhou.aliyuncs.com/hdp-eco/hive
    depends_on:
      - mysql
      - hadoop
      - manager
    hostname: hive
    volumes:
      - ./hive/conf/hive-site.xml:/usr/lib/hive/conf/hive-site.xml
  hue:
    image: gethue/hue:latest
    hostname: hue
    container_name: hue
    ports:
      - "8888:8888"
    volumes:
      - ./hue/hue.ini:/usr/share/hue/desktop/conf/z-hue.ini
      - ./hue/wait-for-it.sh:/usr/share/hue/wait-for-it.sh
    entrypoint: /usr/share/hue/wait-for-it.sh mysql:3306 --timeout=30 --strict -- /usr/share/hue/startup.sh
    depends_on:
      - mysql
      - hadoop
      - hive

  mysql:
    container_name: mysql
    image: mysql:8.0.11
    command: --default-authentication-plugin=mysql_native_password --init-file /data/application/init.sql
    volumes:
      - ./hue/init.sql:/data/application/init.sql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: 111111
      MYSQL_DATABASE: hue
      MYSQL_USER: hue
      MYSQL_PASSWORD: 111111
    ports:
      - 3306:3306
    hostname: mysql
  
  adminer:
    image: adminer
    restart: always
    hostname: adminer
    container_name: adminer
    ports:
      - 18080:8080
  
  # miniconda:
  #   image: continuumio/miniconda
  #   container_name: miniconda
  #   command: /bin/bash -c "/opt/conda/bin/conda install jupyter -y --quiet && mkdir /opt/notebooks && /opt/conda/bin/jupyter notebook --notebook-dir=/opt/notebooks --ip='*' --port=8888 --no-browser"
  #   ports:
  #     - 18888:8888
